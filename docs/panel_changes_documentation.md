## Документация по изменениям в панелях "Настройки" и "Конфиденциальность"

### 1. Описание Проблемы

Изначально в приложении существовала проблема с управлением региональными настройками и конфиденциальностью:
*   **Панель конфиденциальности (`PrivacyPanel`)**: Содержала смешанную логику для глобальных настроек конфиденциальности (сбор данных, анонимизация) и выбора региона. Список регионов был обширным, но его отображение в выпадающем списке было неинформативным (только "Южный", "Северный" и т.д.), что не позволяло пользователю понять, какой город или область он выбирает.
*   **Взаимодействие панелей**: При выборе региона в `PrivacyPanel` основная панель настроек (`SettingsPanel`) закрывалась, что прерывало пользовательский опыт и дезориентировало, поскольку пользователь терял контекст текущих настроек.
*   **Отсутствие отображения текущего региона**: В `SettingsPanel` не было четкого отображения текущего выбранного города или области, что затрудняло понимание активной региональной привязки.

### 2. Предложенное Решение

Для улучшения пользовательского опыта, логического разделения функционала и соблюдения принципов чистого кода, было принято решение:
1.  **Разделить функционал**: Вынести всю логику, связанную с выбором региона и отслеживанием локации, в отдельную, специализированную панель.
2.  **Упростить `PrivacyPanel`**: Оставить в `PrivacyPanel` только базовые настройки конфиденциальности, связанные с общими правилами использования данных.
3.  **Улучшить `SettingsPanel`**: Добавить в `SettingsPanel` кнопку для быстрого доступа к новой панели выбора локации, а также отображение текущего выбранного региона.

### 3. Реализованные Изменения

#### 3.1. `LocationSelectionPanel` (Новая Панель)

*   **Назначение**: Отдельная панель для управления региональными настройками и выбора локации.
*   **Создан файл**: `Assets/App/Develop/Scenes/PersonalAreaScene/Panels/LocationSelectionPanel/LocationSelectionPanelController.cs`.
*   **Создан генератор**: `Assets/App/Editor/Generators/UI/Panels/LocationSelectionPanelGenerator.cs`.
*   **Функционал**:
    *   Полный список регионов и городов Беларуси (с возможностью добавления международных опций).
    *   Переключатель для ручного или автоматического определения региона.
    *   Кнопка "Обновить местоположение" (для автоматического режима).
    *   Сохранение и сброс настроек локации.
    *   Отображение текущего выбранного региона в реальном времени.
    *   Система уведомлений о сохранении/сбросе/ошибках.

#### 3.2. `PrivacyPanel` (Упрощение)

*   **Файл**: `Assets/Scripts/PrivacyPanel.cs`
*   **Изменения**:
    *   **Удалены поля**:
        *   `_useManualRegionToggle` (Toggle для ручного выбора региона)
        *   `_regionDropdown` (Dropdown для выбора региона)
        *   `_currentLocationText` (Текст текущего местоположения)
        *   `_refreshLocationButton` (Кнопка обновления местоположения)
    *   **Удалена логика**:
        *   Инициализация списка доступных регионов (`InitializeAvailableRegions()`).
        *   Обработчики событий для выбора региона (`OnUseManualRegionChanged()`, `OnRegionChanged()`, `OnRefreshLocationClicked()`).
        *   Методы для обновления UI, связанные с регионом (`UpdateRegionDropdown()`, `UpdateRegionControls()`, `UpdateCurrentLocationText()`).
    *   **Добавлено поле**:
        *   `_locationStatusText`: Для отображения статуса отслеживания локации с подсказкой о наличии отдельной панели для выбора региона.
    *   **Обновленная логика**: Все методы, связанные с PlayerPrefs, подписки/отписки событий, загрузка/сохранение настроек были адаптированы под новую, упрощенную структуру панели.
    *   **Обновленный текст**: Информационные и подсказывающие тексты (`_privacyInfoText`, `_dataUsageText`) были переформулированы для отражения разделения функционала и направления пользователя к новой панели локации.
*   **Генератор (`PrivacyPanelGenerator.cs`)**: Обновлен `namespace` для соответствия новому расположению файла.

#### 3.3. `SettingsPanel` (Интеграция)

*   **Файлы**:
    *   `Assets/App/Develop/Scenes/PersonalAreaScene/Panels/SettingsPanel/SettingsPanelController.cs`
    *   `Assets/App/Editor/Generators/UI/Panels/SettingsPanelGenerator.cs`
*   **Изменения в `SettingsPanelController.cs`**:
    *   **Обновлена структура `RegionOption`**: Теперь использует `Id`, `DisplayName`, `Description`, `IsAutomatic` для единообразия с `LocationSelectionPanel`.
    *   **Обновлен список `_regionOptions`**: Содержит полный список регионов, аналогичный `LocationSelectionPanel`.
    *   **Добавлено поле**: `_currentRegionText` для отображения выбранного региона в основной панели.
    *   **Добавлено поле**: `_locationPanel` для ссылки на новую панель выбора локации.
    *   **Добавлена кнопка**: `_locationSettingsButton` для вызова `LocationSelectionPanel`.
    *   **Реализован метод**: `ShowLocationPanel()`, который активирует `LocationSelectionPanel` поверх текущей панели и перемещает её на передний план (`SetAsLastSibling()`), предотвращая закрытие основной панели.
    *   **Обновлены методы сохранения/сброса**: Теперь при сохранении/сбросе настроек обновляется и отображение текущего региона.
    *   **Исправлены ошибки компиляции**: Добавлен `using System.Linq;` для использования `FirstOrDefault`.
*   **Изменения в `SettingsPanelGenerator.cs`**:
    *   **Увеличено количество кнопок** в группе действий.
    *   **Добавлена кнопка "Локация"** (`LocationSettingsButton`).
    *   **Добавлен текстовый элемент** `CurrentRegionText` для отображения текущего региона.
    *   **Добавлена ссылка** на контейнер `LocationPanelContainer` и подключен к `_locationPanel` в контроллере через рефлексию.
    *   **Исправлены ошибки компиляции**: Изменены `TextAlignmentOptions.MiddleLeft` на `TextAlignmentOptions.MidlineLeft` и `TextAlignmentOptions.MiddleCenter` на `TextAlignmentOptions.Center` для совместимости.

### 4. Проверка и Тестирование

*   **Успешная компиляция**: Все перечисленные ошибки компиляции были исправлены.
*   **Визуальная проверка**: После генерации новых префабов панелей, необходимо провести визуальную проверку в Unity Editor, чтобы убедиться, что UI элементы расположены корректно и соответствуют макету.
*   **Функциональное тестирование**: Необходимо проверить:
    *   Работу всех переключателей и кнопок в `PrivacyPanel`.
    *   Корректность выбора региона в `LocationSelectionPanel`, включая автоматический и ручной режимы.
    *   Правильное отображение текущего региона в `SettingsPanel`.
    *   Открытие `LocationSelectionPanel` из `SettingsPanel` без закрытия последней.
    *   Сохранение и сброс настроек в обеих панелях.

Это исчерпывающий обзор проделанной работы. 